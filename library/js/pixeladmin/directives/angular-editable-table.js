function editableTableCtrl(t,i){"use strict";var o=this,r=this;function n(){r.$editor.is(":visible")&&r.$editor.offset(r.active.offset()).width(r.active.width()).height(r.active.height())}this.init=function(e){o.options=e,o.$editor=e.editor.clone(!0).css("position","absolute").hide().appendTo(t.parent()),o.$editor.blur(function(){o.setActiveText(),o.$editor.hide()}).keydown(function(e){if(13===e.which)r.setActiveText(),r.$editor.hide(),r.active.focus(),e.preventDefault(),e.stopPropagation();else if(27===e.which)r.$editor.val(r.active.text()),e.preventDefault(),e.stopPropagation(),r.$editor.hide(),r.active.focus();else if(9===e.which)r.active.focus();else if(this.selectionEnd-this.selectionStart===this.value.length){var t=r.movement(r.active,e.which);0<t.length&&(t.focus(),e.preventDefault(),e.stopPropagation())}}).on("input paste",function(){var e=$.Event("validate");o.active.trigger(e,o.$editor.val()),!1===e.result?o.$editor.addClass("error"):o.$editor.removeClass("error")}),angular.element(i).on("resize",n)},this.destroy=function(){t.css("cursor","").off().find("td").removeAttr("tabindex"),angular.element(i).off("resize",n),o.$editor.off().remove()},this.showEditor=function(e){o.active=t.find("td:focus"),o.active.length&&(o.$editor.val(o.active.text()).removeClass("error").show().offset(o.active.offset()).css(o.active.css(o.options.cloneProperties)).width(o.active.width()).height(o.active.height()).focus(),e&&o.$editor.select())},this.setActiveText=function(){var e,t=o.$editor.val(),i=$.Event("change");if(o.active.text()===t||o.$editor.hasClass("error"))return!0;e=o.active.html(),o.active.text(t).trigger(i,t),!1===i.result&&o.active.html(e)},this.movement=function(e,t){return 39===t?e.next("td"):37===t?e.prev("td"):38===t?e.parent().prev().children().eq(e.index()):40===t?e.parent().next().children().eq(e.index()):[]},t.on("click keypress dblclick",this.showEditor).css("cursor","pointer").keydown(function(e){var t=o.movement(angular.element(e.target),e.which),i=!0;0<t.length?t.focus():13===e.which?o.showEditor(!1):i=((17===e.which||91===e.which||93===e.which)&&o.showEditor(!0),!1),i&&(e.stopPropagation(),e.preventDefault())}),t.find("td").prop("tabindex",1)}function editableTableDirective(n){"use strict";var a={cloneProperties:["padding","padding-top","padding-bottom","padding-left","padding-right","text-align","font","font-size","font-family","font-weight","border","border-top","border-bottom","border-left","border-right"],editor:angular.element("<input>")},s=["onChange","onValidate"];return{restrict:"A",controller:["$element","$window",editableTableCtrl],link:function(t,i,o,e){var r={};Object.keys(a).forEach(function(e){void 0!==o[e]?r[e]=n(o[e])(t):r[e]=a[e]}),e.init(r),s.forEach(function(e){o[e]&&i.on(e.replace(/^on([A-Z])/,function(e,t){return t.toLowerCase()}),"td",n(o[e])(t))}),i.on("$destroy",e.destroy)}}}angular.module("angular-editable-table",[]).directive("editableTable",["$parse",editableTableDirective]);